---

## üîÅ **Polymorphism in C++**

Polymorphism = *"Many Forms"*.
It allows the same function name to behave differently depending on the object invoking it.

<h3>Polymorphism</h3>
 
Different forms of the function are provided.
The call is resolved at compile time or runtime.
Runtime polymorphism or dynamic binding.
Implemented through virtual mechanism.
Compiler inserts code to invoke the correct function at runtime.
Automatically generated through the virtual keyword.
Such functions are called polymorphic functions.
Should be invoked only through a pointer or reference.
 
---

### ‚úÖ **Types of Polymorphism**

| Type                   | Binding Time | Examples                                                                     |
| ---------------------- | ------------ | ---------------------------------------------------------------------------- |
| **Compile-Time**       | Compile Time | Function Overloading, Operator Overloading, Templates                        |
| **Run-Time (Dynamic)** | Run Time     | Virtual Functions, Function Overriding via base class pointers or references |

---

## ‚öôÔ∏è **Compile-Time Polymorphism**

* Also called **Static Binding** or **Early Binding**
* Compiler decides which function to invoke **at compile time**
* **Examples**:

  * Function Overloading
  * Operator Overloading
  * Templates

---

## üïí **Runtime Polymorphism**

* Also called **Dynamic Binding** or **Late Binding**
* Function call is resolved **at runtime**
* Implemented using **Virtual Functions**
* Requires:

  * Function to be marked as `virtual` in the base class
  * Function to be invoked via **base class pointer or reference**

‚ö†Ô∏è If invoked via concrete (non-pointer/non-reference) object, polymorphic behavior does **not work**

---

## üîë **Virtual Functions**

* Declared with the `virtual` keyword in the base class
* Allows **overriding** in derived classes
* Enables **runtime decision** about which function to call

---

## üß† **Virtual Mechanism Internals**

### üîπ Virtual Table (vtable)

* An array of **function pointers** generated by the compiler
* Contains addresses of **virtual functions**
* Created **per class**

### üîπ Virtual Pointer (vptr)

* A hidden member variable in a class with virtual functions
* Points to the class's vtable
* Automatically initialized in the **constructor** by the compiler

---

## üèóÔ∏è Virtual Function Table Behavior

### Example:

```cpp
class Account {
public:
    virtual void AccumulateInterest();
    virtual void Withdraw();
    virtual double GetInterestRate();
    void Deposit(); // Non-virtual
};

class Savings : public Account {
public:
    void AccumulateInterest() override;
    void GetInterestRate() override;
    // Withdraw() is not overridden
};
```

### What happens at compile time:

* **Account vtable** contains:

  * AccumulateInterest()
  * Withdraw()
  * GetInterestRate()
* **Savings vtable** contains:

  * Savings::AccumulateInterest()
  * Account::Withdraw() (inherited)
  * Savings::GetInterestRate()

---

## üîç Function Call Analysis in Assembly

### Scenario:

```cpp
Account* pAccount = new Savings();
pAccount->Deposit();            // Non-virtual
pAccount->AccumulateInterest(); // Virtual
pAccount->Withdraw();           // Virtual
pAccount->GetInterestRate();    // Virtual
```

### Call Behavior:

| Function               | Type        | Resolution Time | Access Mechanism         | Offset in vtable |
| ---------------------- | ----------- | --------------- | ------------------------ | ---------------- |
| `Deposit()`            | Non-virtual | Compile Time    | Direct function call     | N/A              |
| `AccumulateInterest()` | Virtual     | Runtime         | vptr ‚ûù vtable ‚ûù offset 0 | 0                |
| `Withdraw()`           | Virtual     | Runtime         | vptr ‚ûù vtable ‚ûù offset 4 | 4 bytes          |
| `GetInterestRate()`    | Virtual     | Runtime         | vptr ‚ûù vtable ‚ûù offset 8 | 8 bytes          |

üìå On 32-bit platforms:

* Pointer size = 4 bytes
* vtable offset is calculated in multiples of 4

---

## üß± Summary

| Concept                   | Key Idea                                                             |
| ------------------------- | -------------------------------------------------------------------- |
| Polymorphism              | Same interface, different behavior                                   |
| Compile-Time Polymorphism | Resolved by compiler using overloading/templates                     |
| Runtime Polymorphism      | Resolved by vtable/vptr mechanism via base class pointers/references |
| Virtual Function          | Enables function overriding and runtime dispatch                     |
| vtable                    | Lookup table containing virtual function addresses                   |
| vptr                      | Pointer in object that points to class's vtable                      |
| Offset in vtable          | Determined by function order and pointer size                        |

---
